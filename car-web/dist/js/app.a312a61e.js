(function(e){function t(t){for(var n,r,o=t[0],c=t[1],l=t[2],u=0,m=[];u<o.length;u++)r=o[u],Object.prototype.hasOwnProperty.call(s,r)&&s[r]&&m.push(s[r][0]),s[r]=0;for(n in c)Object.prototype.hasOwnProperty.call(c,n)&&(e[n]=c[n]);d&&d(t);while(m.length)m.shift()();return i.push.apply(i,l||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],n=!0,o=1;o<a.length;o++){var c=a[o];0!==s[c]&&(n=!1)}n&&(i.splice(t--,1),e=r(r.s=a[0]))}return e}var n={},s={app:0},i=[];function r(t){if(n[t])return n[t].exports;var a=n[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=n,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/";var o=window["webpackJsonp"]=window["webpackJsonp"]||[],c=o.push.bind(o);o.push=t,o=o.slice();for(var l=0;l<o.length;l++)t(o[l]);var d=c;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"01f0":function(e,t,a){e.exports=a.p+"img/video.f77bf0dc.png"},"0cd4":function(e,t,a){"use strict";a("e7d2")},"56d7":function(e,t,a){"use strict";a.r(t);a("ab8b");var n=a("2b0e"),s=function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},i=[],r={name:"App"},o=r,c=(a("9b23"),a("2877")),l=Object(c["a"])(o,s,i,!1,null,null,null),d=l.exports,u=a("8c4f"),m=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"car-detail"},[t("div",{staticClass:"main-title-container"},[t("div",{staticClass:"first-title"},[e._v(" "+e._s(e.carInfo.dealer.dealerName)+" / ")]),t("div",{staticClass:"second-title"},[e._v(" "+e._s(e.carInfo.saleTitle)+" ")])]),t("div",{staticClass:"row mb-4"},[t("div",{staticClass:"col-md-6"},[t("div",{staticClass:"main-image mb-3"},[t("swiper",{ref:"mySwiper",attrs:{options:e.swiperOptions}},[e._l(e.allSwaggerImages,(function(a,n){return t("swiper-slide",{key:n},["youtube"===a.type?t("div",{staticClass:"video-container"},[t("iframe",{attrs:{width:"100%",height:"100%",src:e.convertToEmbedUrl(a.url),frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:""}})]):"video"===a.type?t("video",{attrs:{controls:"",width:"100%"}},[t("source",{attrs:{src:a.url,type:"video/mp4"}})]):t("img",{staticClass:"img-fluid rounded",attrs:{src:a.url,alt:"汽车图片"},on:{click:function(t){return e.showLightbox(n)}}})])})),t("div",{staticClass:"swiper-pagination",attrs:{slot:"pagination"},slot:"pagination"}),t("div",{staticClass:"swiper-button-prev",attrs:{slot:"button-prev"},slot:"button-prev"}),t("div",{staticClass:"swiper-button-next",attrs:{slot:"button-next"},slot:"button-next"})],2)],1),t("div",{staticClass:"thumbnail-container"},e._l(e.allSwaggerImages,(function(a,n){return t("img",{key:n,staticClass:"thumbnail",class:{active:e.currentMediaIndex===n},attrs:{src:e.getThumbnailSrc(a)},on:{click:function(t){return e.changeMedia(n)}}})})),0),t("div",{staticClass:"share-container"},[t("div",{staticClass:"line-it-button",staticStyle:{display:"none"},attrs:{"data-lang":"zh_Hant","data-type":"share-a","data-env":"REAL","data-url":"https://sale.carce.cc/car/preview/"+e.carId,"data-color":"default","data-size":"large","data-count":"false","data-ver":"3"}})])]),t("div",{staticClass:"col-md-6"},[t("h2",{staticClass:"car-title"},[e._v(e._s(e.carInfo.title))]),t("div",{staticClass:"price mb-3"},[t("span",{staticClass:"h4"},[e._v("$"+e._s(e.carInfo.price))])]),t("div",{staticClass:"specs mb-3"},[t("div",{staticClass:"row"},e._l(e.carInfo.specs,(function(a,n){return t("div",{key:n,staticClass:"col-6 col-sm-6 col-md-4 col-lg-3 mb-3"},[t("div",{staticClass:"spec-name text-muted"},[e._v(e._s(a.name))]),t("div",{staticClass:"spec-value"},[e._v(e._s(a.value))])])})),0)]),t("div",{staticClass:"action-buttons"},[t("button",{staticClass:"btn btn-phone",on:{click:e.callPhone,mouseenter:function(t){e.phoneButtonHover=!0},mouseleave:function(t){e.phoneButtonHover=!1}}},[t("i",{staticClass:"bi bi-telephone"}),e._v(" "+e._s(e.phoneButtonHover?e.carInfo.dealer.companyPhone||"暂无电话":"撥打電話")+" ")]),t("button",{staticClass:"btn btn-line",on:{click:e.contactLine,mouseenter:function(t){e.lineButtonHover=!0},mouseleave:function(t){e.lineButtonHover=!1}}},[t("i",{staticClass:"bi bi-chat-dots"}),e._v(" "+e._s(e.lineButtonHover?e.carInfo.dealer.lineId||"暂无Line ID":"LINE")+" ")])]),t("div",{staticClass:"dealer-info mt-3 text-left"},[t("div",{staticClass:"dealer-contact"},[e._v("聯絡人： "+e._s(e.carInfo.dealer.contactPerson||"--"))]),t("div",{staticClass:"dealer-address"},[e._v(" 賞車地址： "+e._s(e.carInfo.dealer.publicAddress)+" 📍"),t("a",{attrs:{href:"https://www.google.com/maps/search/?api=1&query="+encodeURIComponent(e.carInfo.publicAddress),target:"_blank"}},[e._v("查看地圖")])])])])]),t("div",{staticClass:"tabs"},[t("ul",{staticClass:"nav nav-tabs"},e._l(e.tabs,(function(a,n){return t("li",{key:n,staticClass:"nav-item"},[t("a",{staticClass:"nav-link",class:{active:e.activeTab===a},on:{click:function(t){e.activeTab=a}}},[e._v(" "+e._s(a.title)+" ")])])})),0),t("div",{staticClass:"tab-content p-3 border border-top-0 rounded-bottom"},[t("div",{directives:[{name:"show",rawName:"v-show",value:"car_equipments"===e.activeTab.code,expression:"activeTab.code === 'car_equipments'"}]},[t("div",{staticClass:"equipment-header"},[e._v(" 車輛配備 ")]),e._l(e.carEquipments,(function(a,n){return t("div",{key:n,staticClass:"equipment-section"},[t("div",{staticClass:"equipment-row d-flex flex-column flex-md-row"},[t("div",{staticClass:"equipment-name"},[e._v(e._s(a.name))]),t("div",{staticClass:"equipment-tags"},e._l(a.tags,(function(a,n){return t("span",{key:n,staticClass:"equipment-tag"},[t("i",{staticClass:"iconfont"},[e._v("")]),e._v(" "+e._s(a)+" ")])})),0)])])})),t("div",{staticClass:"equipment-header"},[e._v(" 賣家保證 ")]),t("div",{staticClass:"guarantee-tags"},e._l(e.carGuarantees,(function(a,n){return t("div",{key:n,staticClass:"guarantee-section"},[t("div",{staticClass:"guarantee-name"},[t("i",{staticClass:"iconfont"},[e._v("")]),e._v(e._s(a.itemName))]),t("div",{staticClass:"guarantee-desc"},[e._v(" "+e._s(a.description)+" ")])])})),0),t("div",{staticClass:"equipment-header"},[e._v(" 車輛描述 ")]),t("iframe",{ref:"contentFrame",staticClass:"content-frame",attrs:{srcdoc:e.getHtmlContent(e.carInfo.saleDescription),frameborder:"0",width:"100%"}}),t("div",{staticStyle:{height:"1em"}})],2),t("div",{directives:[{name:"show",rawName:"v-show",value:"dealer_intro"===e.activeTab.code,expression:"activeTab.code === 'dealer_intro'"}]},[t("div",{staticClass:"dealer-container"},[t("div",{staticClass:"dealer-intro"},[t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("店家名稱")]),t("div",{staticClass:"dealer-content"},[e._v(e._s(e.carInfo.dealer.dealerName||"--"))])]),t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("店家地址")]),t("div",{staticClass:"dealer-content"},[e._v(e._s(e.carInfo.dealer.publicAddress||"--"))])]),t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("聯絡人")]),t("div",{staticClass:"dealer-content"},[e._v(e._s(e.carInfo.dealer.contactPerson||"--"))])]),t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("店家電話")]),t("div",{staticClass:"dealer-content"},[e._v(e._s(e.carInfo.dealer.companyPhone||"--"))])]),t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("手機")]),t("div",{staticClass:"dealer-content"},[e._v(e._s(e.carInfo.dealer.companyMobile||"--"))])]),t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("LINE")]),t("div",{staticClass:"dealer-content"},[e.carInfo.dealer.lineId?t("button",{staticClass:"btn-line-id",on:{click:e.contactLine,mouseenter:function(t){e.lineIdHover=!0},mouseleave:function(t){e.lineIdHover=!1}}},[t("i",{staticClass:"bi bi-chat-dots"}),e._v(" "+e._s(e.lineIdHover?e.carInfo.dealer.lineId:"LINE聯絡我")+" ")]):t("span",[e._v("--")])])]),t("div",{staticClass:"dealer-intro-row"},[t("div",{staticClass:"dealer-title"},[e._v("網址")]),t("div",{staticClass:"dealer-content"},[e._v(e._s(e.carInfo.dealer.website||"--"))])])]),t("div",{staticClass:"dealer-cover"},[t("img",{attrs:{src:e.carInfo.dealer.coverImage,alt:"店家封面"}})])]),t("iframe",{ref:"dealerContentFrame",staticClass:"content-frame",attrs:{srcdoc:e.getHtmlContent(e.carInfo.dealer.description),frameborder:"0",width:"100%"}})])])]),t("vue-easy-lightbox",{attrs:{visible:e.visibleLightbox,imgs:e.lightboxImages,index:e.lightboxIndex},on:{hide:function(t){e.visibleLightbox=!1}}})],1)},p=[],h=(a("14d9"),a("e9f5"),a("910d"),a("7d54"),a("ab43"),a("7212")),v=(a("a7a3"),a("cee4")),f=a("825ae"),g={components:{swiper:h["swiper"],swiperSlide:h["swiperSlide"],VueEasyLightbox:f["a"]},data(){return{allSwaggerImages:[],swiperOptions:{pagination:{el:".swiper-pagination",clickable:!0},navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},loop:!0,autoplay:!1},phoneButtonHover:!1,lineButtonHover:!1,lineIdHover:!1,currentMediaIndex:0,activeTab:{},showVideo:!1,carImages:[],carVideo:[],carInfo:{dealer:{}},carId:"",carEquipments:[],carGuarantees:[],tabs:[{title:"車輛配備",code:"car_equipments"},{title:"車商介紹",code:"dealer_intro"}],visibleLightbox:!1,lightboxIndex:0}},computed:{currentImage(){return this.allSwaggerImages[this.currentMediaIndex]},lightboxImages(){return this.allSwaggerImages.filter(e=>"image"===e.type).map(e=>e.url)}},mounted(){const e=this.$refs.mySwiper.swiper;e.on("slideChange",()=>{this.currentMediaIndex=e.realIndex}),this.activeTab=this.tabs[0],this.$watch("activeTab",e=>{"car_desc"===e.code?this.$nextTick(()=>{this.resizeContentFrame("contentFrame")}):"dealer_intro"===e.code&&this.$nextTick(()=>{this.resizeContentFrame("dealerContentFrame")})}),this.$nextTick(()=>{this.setupAllContentFrames()}),window.addEventListener("message",this.handleIframeMessage)},beforeDestroy(){window.removeEventListener("message",this.handleIframeMessage)},updated(){"car_desc"===this.activeTab.code?this.resizeContentFrame("contentFrame"):"dealer_intro"===this.activeTab.code&&this.resizeContentFrame("dealerContentFrame")},async created(){const e=this.$route.params.id;this.carId=e,console.log("当前车辆 ID:",e),this.fetchCarBaseInfo(e),this.fetchCarEquipments(e),this.fetchCarGuarantees(e),await this.fetchCarImages(e),await this.fetchCarVideo(e),this.initAllSwaggerImages()},methods:{initAllSwaggerImages(){let e=[];this.carVideo&&this.carVideo.length>0&&e.push({url:this.carVideo[0],type:this.isYoutubeVideo(this.carVideo[0])?"youtube":"video"}),this.allSwaggerImages=e.concat(this.carImages.map(e=>({url:e,type:"image"})))},handleIframeMessage(e){if(e.data&&("iframe-loaded"===e.data.type||"iframe-resized"===e.data.type)){const t=document.querySelectorAll("iframe.content-frame");t.forEach(t=>{try{t.contentWindow===e.source&&(t.style.height=e.data.height+"px")}catch(a){console.error("处理iframe消息出错",a)}})}},setupAllContentFrames(){const e=document.querySelectorAll("iframe.content-frame");e.forEach(e=>{e.onload=()=>{try{e.style.height=e.contentWindow.document.body.scrollHeight+50+"px";const a=new ResizeObserver(t=>{for(let a of t)a.target===e.contentWindow.document.body&&(e.style.height=a.target.scrollHeight+50+"px")});try{a.observe(e.contentWindow.document.body)}catch(t){console.warn("无法监听iframe内容变化",t)}}catch(t){console.error("调整iframe高度失败",t)}},e.contentDocument&&"complete"===e.contentDocument.readyState&&e.onload()})},resizeContentFrame(e){const t=this.$refs[e];t&&(t.onload=()=>{try{const e=t.contentWindow.document.body,a=e.scrollHeight;t.style.height=a+"px"}catch(e){console.error("调整iframe高度失败",e)}})},getHtmlContent(e){return`\n                <!DOCTYPE html>\n                <html>\n                <head>\n                    <meta charset="utf-8">\n                    <meta name="viewport" content="width=device-width, initial-scale=1">\n                    <style>\n                        body {\n                            font-family: Arial, sans-serif;\n                            line-height: 1.6;\n                            color: #333;\n                            padding: 0;\n                            margin: 0;\n                        }\n                        img {\n                            max-width: 100%;\n                            height: auto;\n                        }\n                        table {\n                            border-collapse: collapse;\n                            width: 100%;\n                        }\n                        td, th {\n                            border: 1px solid #ddd;\n                            padding: 8px;\n                        }\n                    </style>\n                    <script>\n                        // 在加载完成后通知父页面更新高度\n                        window.addEventListener('load', function() {\n                            // 通知父页面已加载完成\n                            if(window.parent && window.parent.postMessage) {\n                                window.parent.postMessage({\n                                    type: 'iframe-loaded',\n                                    height: document.body.scrollHeight\n                                }, '*');\n                            }\n                            \n                            // 监听内容变化\n                            const observer = new MutationObserver(function() {\n                                if(window.parent && window.parent.postMessage) {\n                                    window.parent.postMessage({\n                                        type: 'iframe-resized',\n                                        height: document.body.scrollHeight\n                                    }, '*');\n                                }\n                            });\n                            \n                            // 监听body的所有变化，包括子元素\n                            observer.observe(document.body, {\n                                attributes: true,\n                                childList: true,\n                                subtree: true\n                            });\n                            \n                            // 监听图片加载完成事件\n                            document.querySelectorAll('img').forEach(img => {\n                                img.addEventListener('load', function() {\n                                    if(window.parent && window.parent.postMessage) {\n                                        window.parent.postMessage({\n                                            type: 'iframe-resized',\n                                            height: document.body.scrollHeight\n                                        }, '*');\n                                    }\n                                });\n                            });\n                        });\n                    <\/script>\n                </head>\n                <body>\n                    ${e||""}\n                </body>\n                </html>\n            `},async fetchCarImages(e){let t=this;try{var a=await v["a"].get("/car/api/car/image/"+e);t.carImages=a.data.data,console.log("获取车辆图片成功:",t.carImages)}catch(n){console.error("获取车辆图片失败:",n)}},async fetchCarVideo(e){let t=this;try{var a=await v["a"].get("/car/api/car/video/"+e);t.carVideo=a.data.data,console.log("获取车辆视频成功:",t.carVideo)}catch(n){console.error("获取车辆视频失败:",n)}},fetchCarEquipments(e){let t=this;v["a"].get("/car/api/car/equipment/"+e).then(e=>{t.carEquipments=e.data.data,console.log("获取车辆配备成功:",t.carEquipments)}).catch(e=>{console.error("获取车辆配备失败:",e)})},fetchCarGuarantees(e){let t=this;v["a"].get("/car/api/car/guarantee/"+e).then(e=>{t.carGuarantees=e.data.data,console.log("获取车辆卖家保证成功:",t.carGuarantees)}).catch(e=>{console.error("获取车辆卖家保证失败:",e)})},fetchDealerInfo(e){console.log("获取经销商信息",e);let t=this;v["a"].get("/car/api/car/dealer/"+e).then(e=>{t.carInfo.dealer=e.data.data,t.carInfo.dealer.photos&&t.carInfo.dealer.photos.length>0&&(t.carInfo.dealer.coverImage=t.carInfo.dealer.photos[0]),document.title=t.carInfo.dealer.dealerName+"/"+t.carInfo.saleTitle;const a=document.querySelector('meta[property="og:title"]');if(a)a.setAttribute("content",document.title);else{const e=document.createElement("meta");e.setAttribute("property","og:title"),e.content=document.title,document.getElementsByTagName("head")[0].appendChild(e)}console.log("获取经销商信息成功:",t.carInfo.dealer)}).catch(e=>{console.error("获取经销商信息失败:",e)})},fetchCarBaseInfo(e){let t=this;v["a"].get("/car/api/car/baseInfo/"+e).then(a=>{let n=a.data.data;console.log("获取车辆详情成功:",n),t.carInfo=n,t.carInfo.specs=[{name:"所在城市",value:n.locationName||"--"},{name:"出廠日期",value:n.manufactureYear||"--"},{name:"里程數",value:n.mileage||"--"},{name:"引擎燃料",value:n.fuelSystem||"--"},{name:"排氣量",value:n.displacement||"--"},{name:"變速系統",value:n.transmission||"--"},{name:"車色",value:n.color||"--"},{name:"車門數",value:n.doorCount||"--"},{name:"乘坐人數",value:n.passengerCount||"--"},{name:"汽車品牌",value:n.brand||"--"},{name:"汽車型號",value:n.customModel||"--"}],t.carInfo.title=n.brand+" "+n.customModel+" "+n.manufactureYear,t.carInfo.price=n.salePrice,t.carInfo.dealer={},console.log(t.carInfo.specs),t.fetchDealerInfo(e)}).catch(e=>{console.error("获取车辆详情失败:",e)})},changeMedia(e){this.currentMediaIndex=e;const t=this.$refs.mySwiper.swiper;console.log("changeMedia",e,t),t.slideTo(e)},getThumbnailSrc(e){return"youtube"===e.type?a("5836"):"video"===e.type?a("01f0"):e.url},callPhone(){location.href="tel:"+this.carInfo.dealer.companyPhone},contactLine(){location.href="line://ti/p/"+this.carInfo.dealer.lineId,setTimeout(()=>{location.href="https://line.me/R/ti/p/"+this.carInfo.dealer.lineId},1e3)},isYoutubeVideo(e){return e&&(e.includes("youtube.com")||e.includes("youtu.be"))},convertToEmbedUrl(e){return e.includes("youtube.com/watch?v=")?e.replace("watch?v=","embed/"):e.includes("youtu.be/")?e.replace("youtu.be/","youtube.com/embed/"):e},showLightbox(e){const t=this.getImageOnlyIndex(e);-1!==t&&(this.lightboxIndex=t,this.visibleLightbox=!0)},getImageOnlyIndex(e){const t=this.allSwaggerImages[e];if("image"!==t.type)return-1;let a=0;for(let n=0;n<e;n++)"image"===this.allSwaggerImages[n].type&&a++;return a}}},b=g,w=b,C=(a("0cd4"),Object(c["a"])(w,m,p,!1,null,"739285c8",null)),y=C.exports;n["a"].use(u["a"]);const I=[{path:"/:id",name:"CarDetail",component:y}],_=new u["a"]({mode:"history",routes:I});var x=_,S=a("c71c");a("0808");n["a"].use(S["a"]),n["a"].config.productionTip=!1,new n["a"]({router:x,render:e=>e(d)}).$mount("#app")},5836:function(e,t,a){e.exports=a.p+"img/Youtube.56894d34.png"},"9b23":function(e,t,a){"use strict";a("a5aa")},a5aa:function(e,t,a){},e7d2:function(e,t,a){}});
//# sourceMappingURL=app.a312a61e.js.map